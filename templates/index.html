{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold text-nvidia">
                <i class="bi bi-gpu-card me-3"></i>
                Notebook Analyzer
            </h1>
            <p class="lead text-muted">
                Analyze Jupyter (.ipynb) and marimo (.py) notebooks to determine optimal NVIDIA GPU requirements, 
                VRAM needs, and compliance with best practices.
            </p>
        </div>

        <!-- Analysis Form -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clipboard-data me-2"></i>
                    Analyze Your Notebook
                </h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data" id="analysisForm">
                    <!-- URL Input Section -->
                    <div class="mb-4">
                        <label for="url" class="form-label fw-bold">
                            <i class="bi bi-link-45deg text-nvidia"></i>
                            Option 1: Analyze from URL
                        </label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-globe"></i>
                            </span>
                            <input type="url" 
                                   class="form-control" 
                                   id="url" 
                                   name="url" 
                                   placeholder="https://github.com/user/repo/blob/main/notebook.ipynb"
                                   pattern="https?://.*\.ipynb.*">
                        </div>
                        <div class="form-text">
                            Supports GitHub, GitLab, and direct URLs to .ipynb and .py files
                        </div>
                    </div>

                    <div class="text-center my-3">
                        <span class="badge bg-secondary">OR</span>
                    </div>

                    <!-- File Upload Section -->
                    <div class="mb-4">
                        <label for="file" class="form-label fw-bold">
                            <i class="bi bi-cloud-upload text-nvidia"></i>
                            Option 2: Upload Local File
                        </label>
                        <div class="upload-area p-4 text-center" id="uploadArea">
                            <input type="file" 
                                   class="form-control d-none" 
                                   id="file" 
                                   name="file" 
                                   accept=".ipynb,.py">
                            <div id="uploadText">
                                <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                                <h5>Drop your notebook here or click to browse</h5>
                                <p class="text-muted mb-0">Supports .ipynb (Jupyter) and .py (marimo) files up to 16MB</p>
                            </div>
                            <div id="uploadSelected" class="d-none">
                                <i class="bi bi-file-earmark-code display-4 text-nvidia mb-3"></i>
                                <h5 id="fileName"></h5>
                                <p class="text-muted mb-0">Click analyze to process this file</p>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid">
                        <button type="submit" class="btn btn-nvidia btn-lg" id="submitBtn">
                            <i class="bi bi-play-circle me-2"></i>
                            Analyze Notebook
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="row mt-5">
            <div class="col-md-4 mb-3">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="bi bi-gpu-card display-4 text-nvidia mb-3"></i>
                        <h5>GPU Recommendations</h5>
                        <p class="text-muted">Get minimum and optimal GPU configurations with VRAM requirements</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="bi bi-stopwatch display-4 text-nvidia mb-3"></i>
                        <h5>Runtime Estimates</h5>
                        <p class="text-muted">Predicted execution times for different hardware configurations</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="bi bi-shield-check display-4 text-nvidia mb-3"></i>
                        <h5>Compliance Scoring</h5>
                        <p class="text-muted">NVIDIA notebook best practices assessment and recommendations</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('file');
    const urlInput = document.getElementById('url');
    const uploadText = document.getElementById('uploadText');
    const uploadSelected = document.getElementById('uploadSelected');
    const fileName = document.getElementById('fileName');
    const form = document.getElementById('analysisForm');
    const submitBtn = document.getElementById('submitBtn');

    // Handle upload area clicks
    uploadArea.addEventListener('click', function(e) {
        if (e.target !== fileInput) {
            fileInput.click();
        }
    });

    // Handle file selection
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            fileName.textContent = file.name;
            uploadText.classList.add('d-none');
            uploadSelected.classList.remove('d-none');
            urlInput.value = ''; // Clear URL input
        } else {
            uploadText.classList.remove('d-none');
            uploadSelected.classList.add('d-none');
        }
    });

    // Handle URL input changes
    urlInput.addEventListener('input', function() {
        if (urlInput.value.trim()) {
            fileInput.value = '';
            uploadText.classList.remove('d-none');
            uploadSelected.classList.add('d-none');
        }
    });

    // Handle drag and drop
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.name.endsWith('.ipynb') || file.name.endsWith('.py')) {
                fileInput.files = files;
                fileName.textContent = file.name;
                uploadText.classList.add('d-none');
                uploadSelected.classList.remove('d-none');
                urlInput.value = '';
            } else {
                alert('Please upload a .ipynb (Jupyter) or .py (marimo) file');
            }
        }
    });

    // Handle form submission with basic validation
    form.addEventListener('submit', function(e) {
        const url = urlInput.value.trim();
        const file = fileInput.files[0];
        
        if (!url && !file) {
            e.preventDefault();
            alert('Please provide either a URL or upload a file');
            return;
        }

        // Show loading state
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Analyzing...';
        submitBtn.disabled = true;
        
        // Let the form submit normally to /analyze endpoint
    });
});
</script>
{% endblock %} 