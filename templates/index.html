{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold text-nvidia">
                <i class="bi bi-gpu-card me-3"></i>
                Notebook Analyzer
            </h1>
            <p class="lead text-muted">
                Analyze Jupyter (.ipynb) and marimo (.py) notebooks to determine optimal NVIDIA GPU requirements, 
                VRAM needs, and compliance with best practices.
            </p>
        </div>

        <!-- Repository Access Notice for NVIDIA hosted version -->
        {% if is_brev_nvidia %}
        <div class="alert alert-info mb-4" role="alert">
            <div class="d-flex align-items-start">
                <i class="bi bi-info-circle-fill text-primary me-2 mt-1"></i>
                <div>
                    <strong>Repository Access Notice:</strong> This hosted version can only access <strong>public</strong> repositories on GitHub.com and GitLab.com. 
                    For private repositories, please either:
                    <ul class="mb-0 mt-2">
                        <li>Upload your notebook file directly using the file upload option below</li>
                        <li>Configure and run the analyzer locally to access private repositories</li>
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Analysis Form -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clipboard-data me-2"></i>
                    Analyze Your Notebook
                </h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data" id="analysisForm">
                    <!-- URL Input Section -->
                    <div class="mb-4" id="urlSection">
                        <label for="url" class="form-label fw-bold">
                            <i class="bi bi-link-45deg text-nvidia"></i>
                            Option 1: Analyze from URL
                        </label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-globe"></i>
                            </span>
                            <input type="url" 
                                   class="form-control" 
                                   id="url" 
                                   name="url" 
                                   placeholder="https://github.com/user/repo/blob/main/notebook.ipynb"
                                   pattern="https?://.*\.ipynb.*">
                        </div>
                        <div class="form-text">
                            {% if is_brev_nvidia %}
                            Supports <strong>public</strong> GitHub, GitLab, and direct URLs to .ipynb and .py files
                            {% else %}
                            Supports GitHub, GitLab, and direct URLs to .ipynb and .py files
                            {% endif %}
                        </div>
                        <div id="urlDisabledMessage" class="form-text text-muted d-none">
                            <i class="bi bi-info-circle me-1"></i>
                            URL input disabled - file uploaded below. <a href="#" id="clearFileLink">Clear file to use URL</a>
                        </div>
                    </div>

                    <div class="text-center my-3">
                        <span class="badge bg-secondary">OR</span>
                    </div>

                    <!-- File Upload Section -->
                    <div class="mb-4" id="fileSection">
                        <label for="file" class="form-label fw-bold">
                            <i class="bi bi-cloud-upload text-nvidia"></i>
                            Option 2: Upload Local File
                        </label>
                        <div class="upload-area p-4 text-center" id="uploadArea">
                            <input type="file" 
                                   class="form-control d-none" 
                                   id="file" 
                                   name="file" 
                                   accept=".ipynb,.py">
                            <div id="uploadText">
                                <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                                <h5>Drop your notebook here or click to browse</h5>
                                <p class="text-muted mb-0">Supports .ipynb (Jupyter) and .py (marimo) files up to 16MB</p>
                            </div>
                            <div id="uploadSelected" class="d-none">
                                <i class="bi bi-file-earmark-code display-4 text-nvidia mb-3"></i>
                                <h5 id="fileName"></h5>
                                <p class="text-muted mb-0">Click analyze to process this file</p>
                                <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="clearFileBtn">
                                    <i class="bi bi-x-circle me-1"></i>Remove file
                                </button>
                            </div>
                        </div>
                        <div id="fileDisabledMessage" class="form-text text-muted d-none">
                            <i class="bi bi-info-circle me-1"></i>
                            File upload disabled - URL entered above. <a href="#" id="clearUrlLink">Clear URL to upload file</a>
                        </div>
                    </div>

                    <!-- Model Selector (only show if LLM is available) -->
                    {% if llm_available %}
                    <div class="mb-4">
                        <label for="model" class="form-label fw-bold">
                            <i class="bi bi-cpu text-nvidia"></i>
                            AI Model Selection
                        </label>
                        <select class="form-select" id="model" name="model">
                            <option value="">Loading available models...</option>
                        </select>
                        <div class="form-text">
                            <i class="bi bi-info-circle me-1"></i>
                            Choose an AI model for enhanced analysis. Different models offer varying levels of capability and speed.
                            <br/>
                            <span id="modelEnvDefault" class="text-success d-none">
                                <i class="bi bi-check-circle me-1"></i>
                                Default model: <strong id="envModelName"></strong>
                            </span>
                        </div>
                    </div>
                    {% else %}
                    <!-- LLM Not Available Notice -->
                    <div class="mb-4">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Static Analysis Mode:</strong> AI enhancement is not available. Analysis will use pattern detection only.
                            <br>
                            <small class="text-muted">To enable AI enhancement, configure <code>OPENAI_API_KEY</code> and <code>OPENAI_BASE_URL</code> environment variables.</small>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Submit Button -->
                    <div class="d-grid">
                        <button type="submit" class="btn btn-nvidia btn-lg" id="submitBtn">
                            <i class="bi bi-play-circle me-2"></i>
                            Analyze Notebook
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="row mt-5">
            <div class="col-md-4 mb-3">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="bi bi-gpu-card display-4 text-nvidia mb-3"></i>
                        <h5>GPU Recommendations</h5>
                        <p class="text-muted">Get minimum and optimal GPU configurations with VRAM requirements</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="bi bi-stopwatch display-4 text-nvidia mb-3"></i>
                        <h5>Runtime Estimates</h5>
                        <p class="text-muted">Predicted execution times for different hardware configurations</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="bi bi-shield-check display-4 text-nvidia mb-3"></i>
                        <h5>Compliance Scoring</h5>
                        <p class="text-muted">NVIDIA notebook best practices assessment and recommendations</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('file');
    const urlInput = document.getElementById('url');
    const uploadText = document.getElementById('uploadText');
    const uploadSelected = document.getElementById('uploadSelected');
    const fileName = document.getElementById('fileName');
    const form = document.getElementById('analysisForm');
    const submitBtn = document.getElementById('submitBtn');
    
    // New elements for improved UX
    const urlSection = document.getElementById('urlSection');
    const fileSection = document.getElementById('fileSection');
    const urlDisabledMessage = document.getElementById('urlDisabledMessage');
    const fileDisabledMessage = document.getElementById('fileDisabledMessage');
    const clearFileBtn = document.getElementById('clearFileBtn');
    const clearFileLink = document.getElementById('clearFileLink');
    const clearUrlLink = document.getElementById('clearUrlLink');

    // Function to update UI state based on current inputs
    function updateUIState() {
        const hasFile = fileInput.files[0];
        const hasUrl = urlInput.value.trim();
        
        if (hasFile) {
            // File is selected - disable URL input
            urlInput.disabled = true;
            urlInput.classList.add('text-muted');
            urlDisabledMessage.classList.remove('d-none');
            fileDisabledMessage.classList.add('d-none');
            uploadArea.classList.remove('disabled');
        } else if (hasUrl) {
            // URL is entered - disable file upload
            urlInput.disabled = false;
            urlInput.classList.remove('text-muted');
            uploadArea.classList.add('disabled');
            uploadArea.style.pointerEvents = 'none';
            uploadArea.style.opacity = '0.6';
            fileDisabledMessage.classList.remove('d-none');
            urlDisabledMessage.classList.add('d-none');
        } else {
            // Nothing selected - enable both
            urlInput.disabled = false;
            urlInput.classList.remove('text-muted');
            uploadArea.classList.remove('disabled');
            uploadArea.style.pointerEvents = 'auto';
            uploadArea.style.opacity = '1';
            urlDisabledMessage.classList.add('d-none');
            fileDisabledMessage.classList.add('d-none');
        }
    }

    // Function to clear file selection
    function clearFile() {
        fileInput.value = '';
        uploadText.classList.remove('d-none');
        uploadSelected.classList.add('d-none');
        updateUIState();
    }

    // Function to clear URL
    function clearUrl() {
        urlInput.value = '';
        updateUIState();
    }

    // Handle upload area clicks (only when not disabled)
    uploadArea.addEventListener('click', function(e) {
        if (!uploadArea.classList.contains('disabled') && e.target !== fileInput) {
            fileInput.click();
        }
    });

    // Handle file selection
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            fileName.textContent = file.name;
            uploadText.classList.add('d-none');
            uploadSelected.classList.remove('d-none');
            clearUrl(); // Clear URL input
        } else {
            uploadText.classList.remove('d-none');
            uploadSelected.classList.add('d-none');
        }
        updateUIState();
    });

    // Handle URL input changes
    urlInput.addEventListener('input', function() {
        if (urlInput.value.trim()) {
            clearFile(); // Clear file input
        }
        updateUIState();
    });

    // Handle clear buttons
    clearFileBtn.addEventListener('click', clearFile);
    clearFileLink.addEventListener('click', function(e) {
        e.preventDefault();
        clearFile();
    });
    clearUrlLink.addEventListener('click', function(e) {
        e.preventDefault();
        clearUrl();
    });

    // Handle drag and drop (only when not disabled)
    uploadArea.addEventListener('dragover', function(e) {
        if (!uploadArea.classList.contains('disabled')) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }
    });

    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        if (uploadArea.classList.contains('disabled')) {
            return; // Don't process if disabled
        }
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.name.endsWith('.ipynb') || file.name.endsWith('.py')) {
                fileInput.files = files;
                fileName.textContent = file.name;
                uploadText.classList.add('d-none');
                uploadSelected.classList.remove('d-none');
                clearUrl(); // Clear URL input
                updateUIState();
            } else {
                alert('Please upload a .ipynb (Jupyter) or .py (marimo) file');
            }
        }
    });

    // Handle form submission with improved validation
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const url = urlInput.value.trim();
        const file = fileInput.files[0];
        
        if (!url && !file) {
            alert('Please provide either a URL or upload a file');
            return;
        }
        
        if (url && file) {
            // This shouldn't happen with the UI improvements, but handle it gracefully
            if (!confirm('Both URL and file are provided. The uploaded file will be processed and the URL will be ignored. Continue?')) {
                return;
            }
        }
        
        startStreamingAnalysis();
    });
    
    function startStreamingAnalysis() {
        // Preserve theme attributes
        const currentTheme = document.documentElement.getAttribute('data-bs-theme');
        const themeClass = currentTheme === 'dark' ? 'theme-dark' : 'theme-light';
        
        // Show streaming UI
        document.body.innerHTML = `
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header bg-nvidia text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-gear-fill spin me-2"></i>
                                    Analyzing Notebook
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="progress mb-3">
                                    <div class="progress-bar bg-nvidia progress-bar-striped progress-bar-animated" 
                                         role="progressbar" style="width: 0%" id="progressBar">
                                    </div>
                                </div>
                                <div id="progressMessages" class="small text-muted">
                                    <div class="d-flex align-items-center">
                                        <span class="spinner-border spinner-border-sm me-2"></span>
                                        <span id="currentStatus">Starting analysis...</span>
                                    </div>
                                </div>
                                <div id="progressLog" class="mt-3" style="max-height: 200px; overflow-y: auto;">
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button onclick="location.href='/'" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-1"></i>Cancel & Return
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <style>
                /* Preserve theme variables */
                :root {
                    --nvidia-green: #76b900;
                    --nvidia-dark: #1a1a1a;
                    --nvidia-gray: #666;
                    --bg-primary: #f8f9fa;
                    --bg-secondary: #ffffff;
                    --text-primary: #212529;
                    --text-secondary: #6c757d;
                    --border-color: #dee2e6;
                    --shadow-color: rgba(0, 0, 0, 0.075);
                    --upload-bg: #f8f9fa;
                    --upload-border: #dee2e6;
                    --reasoning-bg: #f8f9fa;
                }
                
                [data-bs-theme="dark"] {
                    --nvidia-green: #76b900;
                    --nvidia-dark: #1a1a1a;
                    --nvidia-gray: #9ca3af;
                    --bg-primary: #121212;
                    --bg-secondary: #1e1e1e;
                    --text-primary: #ffffff;
                    --text-secondary: #b3b3b3;
                    --border-color: #404040;
                    --shadow-color: rgba(0, 0, 0, 0.3);
                    --upload-bg: #2a2a2a;
                    --upload-border: #404040;
                    --reasoning-bg: #2a2a2a;
                }
                
                body {
                    background-color: var(--bg-primary);
                    color: var(--text-primary);
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    transition: background-color 0.3s ease, color 0.3s ease;
                }
                
                .card {
                    background-color: var(--bg-secondary);
                    border: 1px solid var(--border-color);
                    box-shadow: 0 0.125rem 0.25rem var(--shadow-color);
                }
                
                .spin { animation: spin 1s linear infinite; }
                @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                .progress-step { 
                    padding: 0.25rem 0.5rem; 
                    margin: 0.1rem 0; 
                    background: var(--reasoning-bg); 
                    border-left: 3px solid var(--nvidia-green); 
                    border-radius: 0 0.25rem 0.25rem 0; 
                    font-size: 0.875rem;
                    opacity: 0;
                    animation: fadeIn 0.3s ease-in forwards;
                    color: var(--text-primary);
                }
                @keyframes fadeIn { to { opacity: 1; } }
            </style>
        `;
        
        // Restore theme attribute
        document.documentElement.setAttribute('data-bs-theme', currentTheme || 'light');
        
        // Create FormData and start streaming
        const formData = new FormData(form);
        
        // Use EventSource for Server-Sent Events
        fetch('/analyze-stream', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.body;
        }).then(body => {
            const reader = body.getReader();
            const decoder = new TextDecoder();
            let progressCount = 0;
            let buffer = '';
            
            function readStream() {
                return reader.read().then(({ done, value }) => {
                    if (done) return;
                    
                    // Add new chunk to buffer
                    buffer += decoder.decode(value, { stream: true });
                    
                    // Process complete messages
                    const lines = buffer.split('\n');
                    
                    // Keep the last potentially incomplete line in buffer
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const jsonStr = line.slice(6).trim();
                                if (jsonStr) {
                                    const data = JSON.parse(jsonStr);
                                    handleStreamMessage(data, ++progressCount);
                                }
                            } catch (e) {
                                console.error('Failed to parse SSE data:', e, 'Line:', line);
                            }
                        }
                    }
                    
                    return readStream();
                });
            }
            
            readStream().catch(err => {
                console.error('Stream reading error:', err);
                showError('Connection lost during analysis');
            });
        }).catch(err => {
            console.error('Fetch error:', err);
            showError('Failed to start analysis');
        });
    }
    
    function handleStreamMessage(data, step) {
        const progressBar = document.getElementById('progressBar');
        const currentStatus = document.getElementById('currentStatus');
        const progressLog = document.getElementById('progressLog');
        
        if (data.type === 'progress') {
            // Update progress bar (estimate based on step count)
            const progress = Math.min(90, step * 15);
            progressBar.style.width = progress + '%';
            
            // Update current status
            currentStatus.textContent = data.message;
            
            // Add to progress log
            const logEntry = document.createElement('div');
            logEntry.className = 'progress-step';
            logEntry.innerHTML = `<i class="bi bi-check-circle-fill text-success me-1"></i>${data.message}`;
            progressLog.appendChild(logEntry);
            progressLog.scrollTop = progressLog.scrollHeight;
            
        } else if (data.type === 'complete') {
            // Analysis complete - redirect to results
            progressBar.style.width = '100%';
            currentStatus.textContent = 'Analysis complete! Redirecting to results...';
            
            // Store results and redirect
            sessionStorage.setItem('analysisResults', JSON.stringify(data));
            setTimeout(() => {
                window.location.href = '/results';
            }, 1000);
            
        } else if (data.type === 'error') {
            showError(data.message);
        }
    }
    
    function showError(message) {
        document.getElementById('progressMessages').innerHTML = `
            <div class="alert alert-danger">
                <i class="bi bi-exclamation-triangle me-2"></i>${message}
            </div>
        `;
        document.getElementById('progressBar').style.width = '100%';
        document.getElementById('progressBar').classList.add('bg-danger');
    }

    // Initialize UI state
    updateUIState();
    
    // Initialize model selector with environment default (only if model selector exists)
    const modelSelect = document.getElementById('model');
    if (modelSelect) {
        // Use requestIdleCallback for non-critical initialization
        if (window.requestIdleCallback) {
            requestIdleCallback(() => initializeModelSelector());
        } else {
            // Fallback for browsers without requestIdleCallback
            setTimeout(() => initializeModelSelector(), 100);
        }
    }
});

function initializeModelSelector() {
    const modelSelect = document.getElementById('model');
    const modelEnvDefault = document.getElementById('modelEnvDefault');
    const envModelName = document.getElementById('envModelName');
    
    // Load available models with caching and parallel requests
    const modelsPromise = fetch('/api/available-models', {
        headers: {
            'Accept-Encoding': 'gzip, deflate',
            'Cache-Control': 'max-age=300'  // Cache for 5 minutes
        }
    }).then(response => response.json());
    
    const defaultModelPromise = fetch('/api/default-model', {
        headers: {
            'Accept-Encoding': 'gzip, deflate',
            'Cache-Control': 'max-age=300'
        }
    }).then(response => response.json());
    
    // Process models data
    modelsPromise.then(data => {
            // Clear loading message
            modelSelect.innerHTML = '';
            
            const models = data.models;
            
            // Add Nemotron models (highest priority)
            if (models.nemotron && models.nemotron.length > 0) {
                const nemotronGroup = document.createElement('optgroup');
                nemotronGroup.label = 'â­ NVIDIA Nemotron (Recommended)';
                models.nemotron.forEach(modelId => {
                    const option = document.createElement('option');
                    option.value = modelId;
                    option.textContent = formatModelName(modelId);
                    nemotronGroup.appendChild(option);
                });
                modelSelect.appendChild(nemotronGroup);
            }
            
            // Add preferred creator models
            if (models.preferred && models.preferred.length > 0) {
                const preferredGroup = document.createElement('optgroup');
                preferredGroup.label = 'Major Model Creators';
                models.preferred.forEach(modelId => {
                    const option = document.createElement('option');
                    option.value = modelId;
                    option.textContent = formatModelName(modelId);
                    preferredGroup.appendChild(option);
                });
                modelSelect.appendChild(preferredGroup);
            }
            
            // Add other useful models
            if (models.others && models.others.length > 0) {
                const othersGroup = document.createElement('optgroup');
                othersGroup.label = 'Other Models';
                models.others.forEach(modelId => {
                    const option = document.createElement('option');
                    option.value = modelId;
                    option.textContent = formatModelName(modelId);
                    othersGroup.appendChild(option);
                });
                modelSelect.appendChild(othersGroup);
            }
            
            // Now get and set the default model using the parallel request
            return defaultModelPromise;
        })
        .then(data => {
            if (data.default_model) {
                // Set the default model as selected
                const option = modelSelect.querySelector(`option[value="${data.default_model}"]`);
                if (option) {
                    option.selected = true;
                    // Show the environment default message
                    envModelName.textContent = data.default_model;
                    modelEnvDefault.classList.remove('d-none');
                } else {
                    // Model not in our list, add it as a custom option
                    const customOption = document.createElement('option');
                    customOption.value = data.default_model;
                    customOption.textContent = `${formatModelName(data.default_model)}`;
                    customOption.selected = true;
                    modelSelect.insertBefore(customOption, modelSelect.firstChild);
                    
                    envModelName.textContent = data.default_model;
                    modelEnvDefault.classList.remove('d-none');
                }
            } else if (modelSelect.options.length > 0) {
                // Select first option if no environment default
                modelSelect.selectedIndex = 0;
            }
        })
        .catch(error => {
            console.log('Could not load models:', error);
            // Fallback to basic options on error
            modelSelect.innerHTML = `
                <option value="nvidia/llama-3.1-nemotron-70b-instruct">NVIDIA Nemotron 70B</option>
                <option value="meta/llama-3.3-70b-instruct">Meta Llama 3.3 70B</option>
                <option value="mistralai/mixtral-8x7b-instruct-v0.1">Mistral Mixtral 8x7B</option>
            `;
            if (modelSelect.options.length > 0) {
                modelSelect.selectedIndex = 0;
            }
        });
}

function formatModelName(modelId) {
    // Remove subjective descriptions and format model names cleanly
    const parts = modelId.split('/');
    const creator = parts[0];
    const model = parts[1] || modelId;
    
    // Capitalize creator names
    const creatorMap = {
        'nvidia': 'NVIDIA',
        'meta': 'Meta',
        'mistralai': 'Mistral AI',
        'deepseek-ai': 'DeepSeek',
        'qwen': 'Qwen',
        'google': 'Google',
        'microsoft': 'Microsoft'
    };
    
    const formattedCreator = creatorMap[creator] || creator.charAt(0).toUpperCase() + creator.slice(1);
    
    // Clean up model name
    let formattedModel = model
        .replace(/-/g, ' ')
        .replace(/\b\w/g, l => l.toUpperCase())
        .replace(/\bV\d+/g, match => match.toUpperCase())
        .replace(/\bB\b/g, 'B') // Keep 'B' for billion
        .replace(/Instruct/g, 'Instruct')
        .replace(/\bIt\b/g, 'IT');
    
    // Add special labels for code specialists
    const codeSpecialists = ['codellama', 'codestral', 'codegemma', 'coder', 'mathstral'];
    let prefix = '';
    if (codeSpecialists.some(specialist => modelId.toLowerCase().includes(specialist))) {
        prefix = 'ðŸ”§ ';
    }
    
    // Model size removed as requested - it's distracting and most names include it anyway
    
    // Special handling for specific models
    if (modelId.includes('nemotron-super')) {
        formattedModel = formattedModel.replace('Nemotron Super', 'Nemotron Super');
    } else if (modelId.includes('nemotron-ultra')) {
        formattedModel = formattedModel.replace('Nemotron Ultra', 'Nemotron Ultra');
    } else if (modelId.includes('nemotron-nano')) {
        formattedModel = formattedModel.replace('Nemotron Nano', 'Nemotron Nano');
    }
    
    return `${prefix}${formattedCreator} ${formattedModel}`;
}
</script>
{% endblock %} 